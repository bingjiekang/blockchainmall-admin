import{o as B,E as d,n as D,y as M,j as q,q as A,r as L,p as U,u as j,z as F}from"../element-plus/element-plus.DXxe7Acq.js";import{x,t as J}from"../@element-plus/@element-plus.vzwj9fNK.js";import{t as R}from"../../assets/index-DIF_1HvL.js";import{a as _}from"../axios/axios.Bo0ATomq.js";import{J as W,b as X,ab as G,S as p,R as a,o as n,a as m,O as l,c as g,ac as H,P as K,V as c,u as f,W as E,X as S}from"../@vue/@vue.Cyfx47te.js";import"../lodash-es/lodash-es.BM2zjOfE.js";import"../async-validator/async-validator.DKvM95Vc.js";import"../@vueuse/@vueuse.CI58GgG-.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../@popperjs/@popperjs.D9SI2xQl.js";import"../normalize-wheel-es/normalize-wheel-es.B6fDCfyv.js";import"../vue-router/vue-router.CTtvUmZ9.js";const Q={class:"header"},Y={key:0},Z={key:1},ee={key:2},te=m("a",{style:{cursor:"pointer","margin-right":"10px"}},"配货完成",-1),oe=m("a",{style:{cursor:"pointer","margin-right":"10px"}},"出库",-1),re=m("a",{style:{cursor:"pointer","margin-right":"10px"}},"关闭订单",-1),be={__name:"Order",setup(ae){const e=W({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,orderNo:"",orderStatus:"",options:[{value:"",label:"全部"},{value:0,label:"待支付"},{value:1,label:"已支付"},{value:2,label:"配货完成"},{value:3,label:"出库成功"},{value:4,label:"交易成功"},{value:-1,label:"手动关闭"},{value:-2,label:"超时关闭"},{value:-3,label:"商家关闭"}]});X(()=>{u()});const u=()=>{e.loading=!0,_.get("/orders",{params:{pageNumber:e.currentPage,pageSize:e.pageSize,orderNo:e.orderNo,orderStatus:e.orderStatus}}).then(r=>{e.tableData=r.list,e.total=r.totalCount,e.currentPage=r.currPage,e.loading=!1})},y=()=>{e.currentPage=1,u()},P=r=>{e.multipleSelection=r},N=r=>{e.currentPage=r,u()},v=r=>{let o;if(r)o=[r];else{if(!e.multipleSelection.length){console.log("state.multipleSelection",e.multipleSelection.length),d.error("请选择项");return}o=e.multipleSelection.map(i=>i.orderId)}_.put("/orders/checkDone",{ids:o}).then(()=>{d.success("配货成功"),u()})},C=r=>{let o;if(r)o=[r];else{if(!e.multipleSelection.length){d.error("请选择项");return}o=e.multipleSelection.map(i=>i.orderId)}_.put("/orders/checkOut",{ids:o}).then(()=>{d.success("出库成功"),u()})},k=r=>{let o;if(r)o=[r];else{if(!e.multipleSelection.length){d.error("请选择项");return}o=e.multipleSelection.map(i=>i.orderId)}_.put("/orders/close",{ids:o}).then(()=>{d.success("关闭成功"),u()})};return(r,o)=>{const i=D,V=F,I=M,b=q,s=A,h=L,z=G("router-link"),T=U,$=j,O=B;return n(),p(O,{class:"order-container"},{header:a(()=>[m("div",Q,[l(i,{style:{width:"200px","margin-right":"10px"},placeholder:"请输入订单号",modelValue:e.orderNo,"onUpdate:modelValue":o[0]||(o[0]=t=>e.orderNo=t),onChange:y,clearable:""},null,8,["modelValue"]),l(I,{onChange:y,modelValue:e.orderStatus,"onUpdate:modelValue":o[1]||(o[1]=t=>e.orderStatus=t),style:{width:"200px","margin-right":"10px"}},{default:a(()=>[(n(!0),g(K,null,H(e.options,t=>(n(),p(V,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(b,{type:"primary",icon:f(x),onClick:o[2]||(o[2]=t=>v())},{default:a(()=>[c("配货完成")]),_:1},8,["icon"]),l(b,{type:"primary",icon:f(x),onClick:o[3]||(o[3]=t=>C())},{default:a(()=>[c("出库")]),_:1},8,["icon"]),l(b,{type:"danger",icon:f(J),onClick:o[4]||(o[4]=t=>k())},{default:a(()=>[c("关闭订单")]),_:1},8,["icon"])])]),default:a(()=>[l(T,{load:e.loading,data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:P},{default:a(()=>[l(s,{type:"selection",width:"55"}),l(s,{prop:"orderNo",label:"订单号",width:"180"}),l(s,{prop:"totalPrice",label:"订单总价"}),l(s,{prop:"orderStatus",label:"订单状态"},{default:a(t=>[m("span",null,E(r.$filters.orderMap(t.row.orderStatus)),1)]),_:1}),l(s,{prop:"payType",label:"支付方式"},{default:a(t=>[t.row.payType==1?(n(),g("span",Y,"支付宝支付")):t.row.payType==2?(n(),g("span",Z,"微信支付")):(n(),g("span",ee,"未知"))]),_:1}),l(s,{prop:"createdAt",label:"注册时间",width:"180"},{default:a(t=>[c(E(f(R)(t.row.createdAt)),1)]),_:1}),l(s,{label:"操作"},{default:a(t=>[t.row.orderStatus==1?(n(),p(h,{key:0,title:"确定配货完成吗？",onConfirm:w=>v(t.row.orderId),"confirm-button-text":"确定","cancel-button-text":"取消"},{reference:a(()=>[te]),_:2},1032,["onConfirm"])):S("",!0),t.row.orderStatus==2?(n(),p(h,{key:1,title:"确定出库吗？",onConfirm:w=>C(t.row.orderId),"confirm-button-text":"确定","cancel-button-text":"取消"},{reference:a(()=>[oe]),_:2},1032,["onConfirm"])):S("",!0),t.row.orderStatus==4||t.row.orderStatus<0?S("",!0):(n(),p(h,{key:2,title:"确定关闭订单吗？",onConfirm:w=>k(t.row.orderId),"confirm-button-text":"确定","cancel-button-text":"取消"},{reference:a(()=>[re]),_:2},1032,["onConfirm"])),l(z,{to:{path:"/order_detail",query:{id:t.row.orderId}}},{default:a(()=>[c("订单详情")]),_:2},1032,["to"])]),_:1})]),_:1},8,["load","data"]),l($,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:N},null,8,["total","page-size","current-page"])]),_:1})}}};export{be as default};
