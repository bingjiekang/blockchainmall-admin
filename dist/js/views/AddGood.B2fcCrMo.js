import{o as q,E as h,v as B,l as R,n as $,x as L,w as z,a as A,s as G,j as D,k as H}from"../element-plus/element-plus.DXxe7Acq.js";import{W as M}from"../wangeditor/wangeditor.CADa4XB2.js";import{_ as O,u as W,a as J,b as T}from"../../assets/index-DIF_1HvL.js";import{b as K,u as Q}from"../vue-router/vue-router.CTtvUmZ9.js";import{a as u}from"../axios/axios.Bo0ATomq.js";import{g as X,r as F,J as Y,b as Z,y as oo,ab as eo,c as v,O as t,R as l,o as f,V as _,S as to,a as lo,W as ao}from"../@vue/@vue.Cyfx47te.js";import"../lodash-es/lodash-es.BM2zjOfE.js";import"../async-validator/async-validator.DKvM95Vc.js";import"../@vueuse/@vueuse.CI58GgG-.js";import"../@element-plus/@element-plus.vzwj9fNK.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../@popperjs/@popperjs.D9SI2xQl.js";import"../normalize-wheel-es/normalize-wheel-es.B6fDCfyv.js";import"../clipboard/clipboard.DnI0MzOy.js";const ro={class:"add"},so=["src"],no={__name:"AddGood",setup(go){const{proxy:b}=X(),y=F(null),I=F(null),k=K(),C=Q(),{id:m}=k.query,e=Y({uploadImgServer:W,token:J("token")||"",id:m,defaultCate:"",goodForm:{goodsName:"",goodsIntro:"",originalPrice:"",sellingPrice:"",stockNum:"",goodsSellStatus:"0",goodsCoverImg:"",tag:""},rules:{goodsName:[{required:"true",message:"请填写商品名称",trigger:["change"]}],originalPrice:[{required:"true",message:"请填写商品价格",trigger:["change"]}],sellingPrice:[{required:"true",message:"请填写商品售价",trigger:["change"]}],stockNum:[{required:"true",message:"请填写商品库存",trigger:["change"]}]},categoryId:"",category:{lazy:!0,lazyLoad(s,o){const{level:n=0,value:r}=s;u.get("/categories",{params:{pageNumber:1,pageSize:1e3,categoryLevel:n+1,parentId:r||0}}).then(g=>{const p=g.list.map(i=>({value:i.categoryId,label:i.categoryName,leaf:n>1}));o(p)})}}});let a;Z(()=>{a=new M(y.value),a.config.showLinkImg=!1,a.config.showLinkImgAlt=!1,a.config.showLinkImgHref=!1,a.config.uploadImgMaxSize=2*1024*1024,a.config.uploadFileName="file",a.config.uploadImgHeaders={token:e.token},a.config.uploadImgHooks={customInsert:function(s,o){console.log("result",o),o.data&&o.data.length&&o.data.forEach(n=>s(n))}},a.config.uploadImgServer=T,Object.assign(a.config,{onchange(){console.log("change")}}),a.create(),m&&u.get(`/goods/${m}`).then(s=>{const{goods:o,firstCategory:n,secondCategory:r,thirdCategory:g}=s;e.goodForm={goodsName:o.goodsName,goodsIntro:o.goodsIntro,originalPrice:o.originalPrice,sellingPrice:o.sellingPrice,stockNum:o.stockNum,goodsSellStatus:String(o.goodsSellStatus),goodsCoverImg:b.$filters.prefix(o.goodsCoverImg),tag:o.tag},e.categoryId=o.goodsCategoryId,e.defaultCate=`${n.categoryName}/${r.categoryName}/${g.categoryName}`,a&&a.txt.html(o.goodsDetailContent)})}),oo(()=>{a.destroy(),a=null});const N=()=>{I.value.validate(s=>{if(s){let o=u.post,n={goodsCategoryId:e.categoryId,goodsCoverImg:e.goodForm.goodsCoverImg,goodsDetailContent:a.txt.html(),goodsIntro:e.goodForm.goodsIntro,goodsName:e.goodForm.goodsName,goodsSellStatus:e.goodForm.goodsSellStatus,originalPrice:e.goodForm.originalPrice,sellingPrice:e.goodForm.sellingPrice,stockNum:e.goodForm.stockNum,tag:e.goodForm.tag};console.log("params",n),m&&(n.goodsId=m,o=u.put),o("/goods",n).then(()=>{h.success(m?"修改成功":"添加成功"),C.push({path:"/good"})})}})},S=s=>{const o=s.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(o))return h.error("请上传 jpg、jpeg、png 格式的图片"),!1},x=s=>{e.goodForm.goodsCoverImg=s.data||""},V=s=>{e.categoryId=s[2]||0};return(s,o)=>{const n=B,r=R,g=$,c=L,p=z,i=eo("Plus"),P=A,w=G,E=D,U=H,j=q;return f(),v("div",ro,[t(j,{class:"add-container"},{default:l(()=>[t(U,{model:e.goodForm,rules:e.rules,ref_key:"goodRef",ref:I,"label-width":"100px",class:"goodForm"},{default:l(()=>[t(r,{required:"",label:"商品分类"},{default:l(()=>[t(n,{placeholder:e.defaultCate,style:{width:"300px"},props:e.category,onChange:V},null,8,["placeholder","props"])]),_:1}),t(r,{label:"商品名称",prop:"goodsName"},{default:l(()=>[t(g,{style:{width:"300px"},modelValue:e.goodForm.goodsName,"onUpdate:modelValue":o[0]||(o[0]=d=>e.goodForm.goodsName=d),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),t(r,{label:"商品简介",prop:"goodsIntro"},{default:l(()=>[t(g,{style:{width:"300px"},type:"textarea",modelValue:e.goodForm.goodsIntro,"onUpdate:modelValue":o[1]||(o[1]=d=>e.goodForm.goodsIntro=d),placeholder:"请输入商品简介(100字)"},null,8,["modelValue"])]),_:1}),t(r,{label:"商品价格",prop:"originalPrice"},{default:l(()=>[t(g,{type:"number",min:"0",style:{width:"300px"},modelValue:e.goodForm.originalPrice,"onUpdate:modelValue":o[2]||(o[2]=d=>e.goodForm.originalPrice=d),placeholder:"请输入商品价格"},null,8,["modelValue"])]),_:1}),t(r,{label:"商品售卖价",prop:"sellingPrice"},{default:l(()=>[t(g,{type:"number",min:"0",style:{width:"300px"},modelValue:e.goodForm.sellingPrice,"onUpdate:modelValue":o[3]||(o[3]=d=>e.goodForm.sellingPrice=d),placeholder:"请输入商品售价"},null,8,["modelValue"])]),_:1}),t(r,{label:"商品库存",prop:"stockNum"},{default:l(()=>[t(g,{type:"number",min:"0",style:{width:"300px"},modelValue:e.goodForm.stockNum,"onUpdate:modelValue":o[4]||(o[4]=d=>e.goodForm.stockNum=d),placeholder:"请输入商品库存"},null,8,["modelValue"])]),_:1}),t(r,{label:"商品标签",prop:"tag"},{default:l(()=>[t(g,{style:{width:"300px"},modelValue:e.goodForm.tag,"onUpdate:modelValue":o[5]||(o[5]=d=>e.goodForm.tag=d),placeholder:"请输入商品小标签"},null,8,["modelValue"])]),_:1}),t(r,{label:"上架状态",prop:"goodsSellStatus"},{default:l(()=>[t(p,{modelValue:e.goodForm.goodsSellStatus,"onUpdate:modelValue":o[6]||(o[6]=d=>e.goodForm.goodsSellStatus=d)},{default:l(()=>[t(c,{label:"0"},{default:l(()=>[_("上架")]),_:1}),t(c,{label:"1"},{default:l(()=>[_("下架")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,{required:"",label:"商品主图",prop:"goodsCoverImg"},{default:l(()=>[t(w,{class:"avatar-uploader",action:e.uploadImgServer,accept:"jpg,jpeg,png",headers:{token:e.token},"show-file-list":!1,"before-upload":S,"on-success":x},{default:l(()=>[e.goodForm.goodsCoverImg?(f(),v("img",{key:0,style:{width:"100px",height:"100px",border:"1px solid #e9e9e9"},src:e.goodForm.goodsCoverImg,class:"avatar"},null,8,so)):(f(),to(P,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[t(i)]),_:1}))]),_:1},8,["action","headers"])]),_:1}),t(r,{label:"详情内容"},{default:l(()=>[lo("div",{ref_key:"editor",ref:y},null,512)]),_:1}),t(r,null,{default:l(()=>[t(E,{type:"primary",onClick:o[7]||(o[7]=d=>N())},{default:l(()=>[_(ao(e.id?"立即修改":"立即创建"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}},Co=O(no,[["__scopeId","data-v-c9b0441e"]]);export{Co as default};
