import{E as m,a as R,s as $,l as z,n as A,k as N,j as B,t as q,o as M,r as O,q as G,p as J,u as W}from"../element-plus/element-plus.DXxe7Acq.js";import{u as H,t as K}from"../@element-plus/@element-plus.vzwj9fNK.js";import{_ as L,u as Q,a as X,t as Y}from"../../assets/index-DIF_1HvL.js";import{a as _}from"../axios/axios.Bo0ATomq.js";import{r as D,J as I,ab as Z,o as v,S as V,R as o,a as p,O as l,V as g,c as T,b as ee,P as te,u as U,W as P}from"../@vue/@vue.Cyfx47te.js";import"../lodash-es/lodash-es.BM2zjOfE.js";import"../async-validator/async-validator.DKvM95Vc.js";import"../@vueuse/@vueuse.CI58GgG-.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../@popperjs/@popperjs.D9SI2xQl.js";import"../normalize-wheel-es/normalize-wheel-es.B6fDCfyv.js";import"../vue-router/vue-router.CTtvUmZ9.js";const le=["src"],oe={class:"dialog-footer"},ae={__name:"DialogAddSwiper",props:{type:String,reload:Function},setup(y,{expose:u}){const t=y,i=D(null),e=I({uploadImgServer:Q,token:X("token")||"",visible:!1,ruleForm:{url:"",link:"",sort:""},rules:{url:[{required:"true",message:"图片不能为空",trigger:["change"]}],sort:[{required:"true",message:"排序不能为空",trigger:["change"]}]},id:""}),w=n=>{_.get(`/carousels/${n}`).then(a=>{e.ruleForm={url:a.carouselUrl,link:a.redirectUrl,sort:a.carouselRank}})},x=n=>{const a=n.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(a))return m.error("请上传 jpg、jpeg、png 格式的图片"),!1},F=n=>{e.ruleForm.url=n.data||""},S=n=>{e.visible=!0,n?(e.id=n,w(n)):e.ruleForm={url:"",link:"",sort:""}},C=()=>{e.visible=!1},r=()=>{console.log(i.value.validate),i.value.validate(n=>{n&&(t.type=="add"?_.post("/carousels",{carouselUrl:e.ruleForm.url,redirectUrl:e.ruleForm.link,carouselRank:e.ruleForm.sort}).then(()=>{m.success("添加成功"),e.visible=!1,t.reload&&t.reload()}):_.put("/carousels",{carouselId:e.id,carouselUrl:e.ruleForm.url,redirectUrl:e.ruleForm.link,carouselRank:e.ruleForm.sort}).then(()=>{m.success("修改成功"),e.visible=!1,t.reload&&t.reload()}))})};return u({open:S,close:C}),(n,a)=>{const h=Z("Plus"),c=R,E=$,f=z,b=A,s=N,k=B,j=q;return v(),V(j,{title:y.type=="add"?"添加轮播图":"修改轮播图",modelValue:e.visible,"onUpdate:modelValue":a[3]||(a[3]=d=>e.visible=d),width:"400px"},{footer:o(()=>[p("span",oe,[l(k,{onClick:a[2]||(a[2]=d=>e.visible=!1)},{default:o(()=>[g("取 消")]),_:1}),l(k,{type:"primary",onClick:r},{default:o(()=>[g("确 定")]),_:1})])]),default:o(()=>[l(s,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:i,"label-width":"100px",class:"good-form"},{default:o(()=>[l(f,{label:"图片",prop:"url"},{default:o(()=>[l(E,{class:"avatar-uploader",action:e.uploadImgServer,accept:"jpg,jpeg,png",headers:{token:e.token},"show-file-list":!1,"before-upload":x,"on-success":F},{default:o(()=>[e.ruleForm.url?(v(),T("img",{key:0,style:{width:"200px",height:"100px",border:"1px solid #e9e9e9"},src:e.ruleForm.url,class:"avatar"},null,8,le)):(v(),V(c,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[l(h)]),_:1}))]),_:1},8,["action","headers"])]),_:1}),l(f,{label:"跳转链接",prop:"link"},{default:o(()=>[l(b,{type:"text",modelValue:e.ruleForm.link,"onUpdate:modelValue":a[0]||(a[0]=d=>e.ruleForm.link=d)},null,8,["modelValue"])]),_:1}),l(f,{label:"排序值",prop:"sort"},{default:o(()=>[l(b,{type:"number",modelValue:e.ruleForm.sort,"onUpdate:modelValue":a[1]||(a[1]=d=>e.ruleForm.sort=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},re=L(ae,[["__scopeId","data-v-27cb3916"]]),ne={class:"header"},se=["src"],ie=["href"],ce=["onClick"],ue=p("a",{style:{cursor:"pointer"}},"删除",-1),xe={__name:"Swiper",setup(y){const u=D(),t=I({loading:!1,tableData:[],currentPage:1,pageSize:10,type:"add",multipleSelection:[],total:0});ee(()=>{i()});const i=()=>{t.loading=!0,_.get("/carousels",{params:{pageNumber:t.currentPage,pageSize:t.pageSize}}).then(r=>{t.tableData=r.list,t.total=r.totalCount,t.currentPage=r.currPage,t.loading=!1})},e=()=>{console.log("addSwiper",u.value),t.type="add",u.value.open()},w=r=>{t.type="edit",u.value.open(r)},x=r=>{t.multipleSelection=r},F=()=>{if(!t.multipleSelection.length){m.error("请选择项");return}_.delete("/carousels",{data:{ids:t.multipleSelection.map(r=>r.carouselId)}}).then(()=>{m.success("删除成功"),i()})},S=r=>{_.delete("/carousels",{data:{ids:[r]}}).then(()=>{m.success("删除成功"),i()})},C=r=>{t.currentPage=r,i()};return(r,n)=>{const a=B,h=O,c=G,E=J,f=W,b=M;return v(),T(te,null,[l(b,{class:"swiper-container"},{header:o(()=>[p("div",ne,[l(a,{type:"primary",icon:U(H),onClick:e},{default:o(()=>[g("增加")]),_:1},8,["icon"]),l(h,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:F},{reference:o(()=>[l(a,{type:"danger",icon:U(K)},{default:o(()=>[g("批量删除")]),_:1},8,["icon"])]),_:1})])]),default:o(()=>[l(E,{load:t.loading,ref:"multipleTable",data:t.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:x},{default:o(()=>[l(c,{type:"selection",width:"55"}),l(c,{label:"轮播图",width:"200"},{default:o(s=>[p("img",{style:{width:"150px",height:"150px","object-fit":"contain"},src:s.row.carouselUrl,alt:"轮播图"},null,8,se)]),_:1}),l(c,{label:"跳转链接"},{default:o(s=>[p("a",{target:"_blank",href:s.row.redirectUrl},P(s.row.redirectUrl),9,ie)]),_:1}),l(c,{prop:"carouselRank",label:"排序值",width:"120"}),l(c,{prop:"createdAt",label:"添加时间",width:"200"},{default:o(s=>[g(P(U(Y)(s.row.createdAt)),1)]),_:1}),l(c,{label:"操作",width:"100"},{default:o(s=>[p("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:k=>w(s.row.carouselId)},"修改",8,ce),l(h,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:k=>S(s.row.carouselId)},{reference:o(()=>[ue]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["load","data"]),l(f,{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,onCurrentChange:C},null,8,["total","page-size","current-page"])]),_:1}),l(re,{ref_key:"addSwiper",ref:u,reload:i,type:t.type},null,8,["type"])],64)}}};export{xe as default};
