import{_ as R,j as P,x as D,r as B,z as $,A as z,D as q,o as f,c as U,w as r,a as y,g as o,d as h,k as T,F as m,i as g,h as A,q as M,J as O,K as G,m as J,s as j,L as K,y as Q,e as W,V as H,f as X,E as Y,N as V,W as Z,t as ee,O as te,P as ae,Q as oe,R as le,S as re,T as ne,U as se}from"./index-BiQKGgRH.js";/* empty css             *//* empty css               *//* empty css              *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                   *//* empty css               *//* empty css                *//* empty css                  *//* empty css                 */const ce=["src"],ie={class:"dialog-footer"},de={__name:"DialogAddCategory",props:{type:String,reload:Function},setup(L,{expose:_}){const i=L,v=P(null),t=D(),e=B({uploadImgServer:$,token:z("token")||"",visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:"",url:""},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"编号不能为空",trigger:["change"]}]},id:""}),d=s=>{g.get(`/categories/${s}`).then(l=>{e.ruleForm={name:l.categoryName,rank:l.categoryRank,url:l.categoryUrl},e.parentId=l.parentId,e.categoryLevel=l.categoryLevel})},x=s=>{const l=s.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(l))return m.error("请上传 jpg、jpeg、png 格式的图片"),!1},C=s=>{e.ruleForm.url=s.data||""},F=s=>{if(e.visible=!0,s)e.id=s,d(s);else{const{level:l=1,parent_id:a=0}=t.query;e.ruleForm={name:"",rank:"",url:""},e.parentId=a,e.categoryLevel=l}},w=()=>{e.visible=!1},I=()=>{v.value.validate(s=>{s&&(i.type=="add"?g.post("/categories",{categoryLevel:e.categoryLevel,parentId:e.parentId,categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank,categoryUrl:e.ruleForm.url}).then(()=>{m.success("添加成功"),e.visible=!1,i.reload&&i.reload()}):g.put("/categories",{categoryId:e.id,categoryLevel:e.categoryLevel,parentId:e.categoryLevel,categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank,categoryUrl:e.ruleForm.url}).then(()=>{m.success("修改成功"),e.visible=!1,i.reload&&i.reload()}))})};return _({open:F,close:w}),(s,l)=>{const a=A,c=M,u=q("Plus"),b=O,p=G,E=J,k=j,S=K;return f(),U(S,{title:e.type=="add"?"添加分类":"修改分类",modelValue:e.visible,"onUpdate:modelValue":l[3]||(l[3]=n=>e.visible=n),width:"400px"},{footer:r(()=>[y("span",ie,[o(k,{onClick:l[2]||(l[2]=n=>e.visible=!1)},{default:r(()=>[h("取 消")]),_:1}),o(k,{type:"primary",onClick:I},{default:r(()=>[h("确 定")]),_:1})])]),default:r(()=>[o(E,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:v,"label-width":"100px",class:"good-form"},{default:r(()=>[o(c,{label:"商品名称",prop:"name"},{default:r(()=>[o(a,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=n=>e.ruleForm.name=n)},null,8,["modelValue"])]),_:1}),o(c,{label:"排序值",prop:"rank"},{default:r(()=>[o(a,{type:"number",modelValue:e.ruleForm.rank,"onUpdate:modelValue":l[1]||(l[1]=n=>e.ruleForm.rank=n)},null,8,["modelValue"])]),_:1}),o(c,{label:"图片",prop:"url"},{default:r(()=>[o(p,{class:"avatar-uploader",action:e.uploadImgServer,accept:"jpg,jpeg,png",headers:{token:e.token},"show-file-list":!1,"before-upload":x,"on-success":C},{default:r(()=>[e.ruleForm.url?(f(),T("img",{key:0,style:{width:"200px",height:"100px","object-fit":"contain",border:"1px solid #e9e9e9"},src:e.ruleForm.url,class:"avatar"},null,8,ce)):(f(),U(b,{key:1,class:"avatar-uploader-icon"},{default:r(()=>[o(u)]),_:1}))]),_:1},8,["action","headers"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},ue=R(de,[["__scopeId","data-v-b1a5a7da"]]),pe={class:"header"},me=["src"],ge=["onClick"],_e=["onClick"],fe=y("a",{style:{cursor:"pointer"}},"删除",-1),Ve={__name:"Category",setup(L){const _=P(null),i=Q(),v=D(),t=B({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});W(()=>{d()}),H(()=>{console.log(t.pageSize)});const e=i.afterEach(a=>{["category","level2","level3"].includes(a.name)&&d()});X(()=>{e()});const d=()=>{const{level:a=1,parent_id:c=0}=v.query;t.loading=!0,g.get("/categories",{params:{pageNumber:t.currentPage,pageSize:t.pageSize,categoryLevel:a,parentId:c}}).then(u=>{t.tableData=u.list,t.total=u.totalCount,t.currentPage=u.currPage,t.loading=!1,t.level=a,t.parentId=c})},x=a=>{t.currentPage=a,d()},C=a=>{const c=a.categoryLevel+1;if(c==4){m.error("没有下一级");return}i.push({name:`level${c}`,query:{level:c,parent_id:a.categoryId}})},F=()=>{t.type="add",_.value.open()},w=a=>{t.type="edit",_.value.open(a)},I=a=>{t.multipleSelection=a},s=()=>{if(!t.multipleSelection.length){m.error("请选择项");return}g.delete("/categories",{data:{ids:t.multipleSelection.map(a=>a.categoryId)}}).then(()=>{m.success("删除成功"),d()})},l=a=>{g.delete("/categories",{data:{ids:[a]}}).then(()=>{m.success("删除成功"),d()})};return(a,c)=>{const u=j,b=te,p=ae,E=oe,k=le,S=Y;return f(),U(S,{class:"category-container"},{header:r(()=>[y("div",pe,[o(u,{type:"primary",icon:V(re),onClick:F},{default:r(()=>[h("增加")]),_:1},8,["icon"]),o(b,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:s},{reference:r(()=>[o(u,{type:"danger",icon:V(ne)},{default:r(()=>[h("批量删除")]),_:1},8,["icon"])]),_:1})])]),default:r(()=>[o(E,{load:t.loading,ref:"multipleTable",data:t.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:I},{default:r(()=>[o(p,{type:"selection",width:"55"}),o(p,{prop:"categoryName",label:"分类名称"}),o(p,{label:"三级分类图",width:"200"},{default:r(n=>[n.row.categoryUrl?(f(),T("img",{key:0,style:{width:"150px",height:"150px","object-fit":"contain"},src:n.row.categoryUrl,alt:"分类图"},null,8,me)):Z("",!0)]),_:1}),o(p,{prop:"categoryRank",label:"排序值",width:"120"}),o(p,{prop:"createdAt",label:"注册时间",width:"200"},{default:r(n=>[h(ee(V(se)(n.row.createdAt)),1)]),_:1}),o(p,{label:"操作",width:"220"},{default:r(n=>[y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:N=>w(n.row.categoryId)},"修改",8,ge),y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:N=>C(n.row)},"下级分类",8,_e),o(b,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:N=>l(n.row.categoryId)},{reference:r(()=>[fe]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["load","data"]),o(k,{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,onCurrentChange:x},null,8,["total","page-size","current-page"]),o(ue,{ref_key:"addCate",ref:_,reload:d,type:t.type},null,8,["type"])]),_:1})}}};export{Ve as default};
